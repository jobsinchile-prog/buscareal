<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>BuscaReal</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#f4f6f8}
header{background:#000;color:#fff;padding:12px}
main{max-width:900px;margin:auto;padding:20px}
.card{background:#fff;padding:16px;border-radius:8px;margin-bottom:16px}
input,select,textarea,button{width:100%;padding:10px;margin-top:8px}
button{background:#000;color:#fff;border:0;border-radius:6px}
.error{color:red;font-weight:bold}
</style>
</head>
<body>

<header><b>BuscaReal</b></header>
<main id="app">Cargando…</main>

<script>
(function(){
  try {

    /* ---------- helpers ---------- */
    const app = document.getElementById("app");
    const load = k => JSON.parse(localStorage.getItem(k) || "null");
    const save = (k,v) => localStorage.setItem(k,JSON.stringify(v));

    /* ---------- db ---------- */
    const db = {
      users: load("users") || [],
      session: load("session")
    };

    if (!db.users.find(u=>u.role==="admin")) {
      db.users.push({id:1,email:"admin@buscareal.cl",pass:"admin",role:"admin"});
      save("users",db.users);
    }

    /* ---------- views ---------- */
    function render(){
      if(!db.session) return landing();
      dashboard();
    }

    function landing(){
      app.innerHTML = `
        <div class="card">
          <h2>Marketplace Inverso</h2>
          <p>Publica lo que buscas. Recibe solo lo que encaja.</p>
        </div>

        <div class="card">
          <h3>Login</h3>
          <input id="email" placeholder="email">
          <input id="pass" type="password" placeholder="password">
          <button id="loginBtn">Entrar</button>
        </div>

        <div class="card">
          <h3>Registro</h3>
          <input id="remail" placeholder="email">
          <input id="rpass" type="password" placeholder="password">
          <select id="rrole">
            <option value="buyer">Comprador</option>
            <option value="seller">Vendedor</option>
          </select>
          <button id="regBtn">Registrar</button>
        </div>
      `;

      document.getElementById("loginBtn").onclick = login;
      document.getElementById("regBtn").onclick = register;
    }

    function dashboard(){
      app.innerHTML = `
        <div class="card">
          <h3>Bienvenido</h3>
          <p>${db.session.email} (${db.session.role})</p>
          <button id="logoutBtn">Salir</button>
        </div>
      `;
      document.getElementById("logoutBtn").onclick = logout;
    }

    /* ---------- actions ---------- */
    function login(){
      const e = document.getElementById("email").value;
      const p = document.getElementById("pass").value;
      const u = db.users.find(u=>u.email===e && u.pass===p);
      if(!u) return alert("Credenciales inválidas");
      db.session = u;
      save("session",u);
      render();
    }

    function register(){
      const e = document.getElementById("remail").value;
      const p = document.getElementById("rpass").value;
      const r = document.getElementById("rrole").value;
      db.users.push({id:Date.now(),email:e,pass:p,role:r});
      save("users",db.users);
      alert("Cuenta creada");
    }

    function logout(){
      db.session = null;
      localStorage.removeItem("session");
      render();
    }

    render();

  } catch (err) {
    document.getElementById("app").innerHTML =
      "<div class='error'>ERROR JS: "+err.message+"</div>";
    console.error(err);
  }
})();
</script>

</body>
</html>
